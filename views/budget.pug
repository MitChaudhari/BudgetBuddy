doctype html
html
    head
        title Budget Manager
        link(rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css')
        link(rel='preconnect' href='https://fonts.googleapis.com')
        link(rel='preconnect' href='https://fonts.gstatic.com', crossorigin)
        link(href='https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap' rel='stylesheet')
        script(src='https://cdn.jsdelivr.net/npm/chart.js')
        style.
            body { font-family: 'Roboto', sans-serif; background-color: #f5f5f7; padding-top: 20px; }
            .card-custom { background: #ffffff; border-radius: 8px; box-shadow: 0 2px 3px rgba(0,0,0,0.1); padding: 20px; margin-bottom: 20px; }
            .highlight { color: #007bff; }
            .header { margin-bottom: 30px; }
            .sub-header { margin-top: 20px; margin-bottom: 10px; }
            #pieChart { height: 400px; width: 100%; } 
    body
        .container
            .row.justify-content-center
                .col-lg-8
                    .card-custom
                        .header
                            h1.text-center Budget Manager
                            h2.text-center Hello, #{user.username}!

                        if budget
                            .sub-header
                                h3 Your current budget limit is $#{budget.limit.toFixed(2)} for #{budget.period}
                                h3 You have spent $#{totalSpent.toFixed(2)} so far.
                                h3 You have $#{remaining.toFixed(2)} remaining in your budget.
                        else
                            .sub-header
                                h3 No budget set. Please define your budget.

                        form(method="POST" action="/budget")
                            .form-group
                                label(for='limit') Set your budget limit:
                                input#limit.form-control(type='number' name='limit', required=true, step="0.01" placeholder='Enter budget limit')
                            .form-group
                                label(for='period') Select the budget period:
                                select#period.form-control(name='period')
                                    option(value='monthly') Monthly
                                    option(value='annually') Annually
                            button.btn.btn-primary(type='submit') Save Budget
                    
                        .sub-header
                            h4.text-center.mb-3 Spending by Category
                            canvas#pieChart

                        .report-download
                            h4 Download Your Spending Report
                            a.btn.btn-secondary(href='/download-report') Download PDF
    script(src='https://code.jquery.com/jquery-3.5.1.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js')
    script(src='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js')
    script.
        document.addEventListener('DOMContentLoaded', function () {
            const ctx = document.getElementById('pieChart').getContext('2d');
            const spendingData = !{spendingByCategory}; // No quotes needed here
            const spendingLabels = Object.keys(spendingData);
            const spendingValues = Object.values(spendingData);
            const colors = spendingLabels.map(label => '#' + Math.floor(Math.random() * 16777215).toString(16));

            const pieChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: spendingLabels,
                    datasets: [{
                        label: 'Spending by Category',
                        data: spendingValues,
                        backgroundColor: colors,
                        hoverOffset: 4
                    }]
                },
                options: {
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        }
                    },
                    responsive: true,  // Chart will resize in response to changes in the size of its container.
                    maintainAspectRatio: true,  // Maintain the aspect ratio defined by the actual canvas size.
                    aspectRatio: 2  // Adjust this value to control the aspect ratio of the pie chart (default is 2)
                }
            });
        });

