doctype html
html
  head
    title Expense Tracker
    link(rel='stylesheet', href='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css')
    script(src="https://code.jquery.com/jquery-3.5.1.min.js")
    script(src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js')
    script(src='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js')

  body
    .container.mt-5
      h1.text-center Expense Tracker
      a(href="/transactions/add", class="btn btn-success mb-3") Add Expense

      // Filter form
      form(method='GET', action='/transactions', class='mb-3')
        .form-row.d-flex.align-items-end
          .form-group.col-md-5
            label(for='category') Category
            select#category.form-control(name='category')
              option(value='') Select category
              option(value='groceries') Groceries
              option(value='utilities') Utilities
              option(value='entertainment') Entertainment
              option(value='dining_out') Dining Out
              option(value='transportation') Transportation
              option(value='health_care') Health Care
              option(value='education') Education
              option(value='personal_care') Personal Care
              option(value='savings') Savings
              option(value='miscellaneous') Miscellaneous
          .form-group.col-md-5
            label(for='date') Date
            input#date.form-control(type='date', name='date')
          .col-md-2.d-flex.align-items-center
            button.btn.btn-primary(type='submit') Filter

      // Transaction table
      table.table.table-striped
        thead
          tr
            th Date
            th Category
            th Amount
            th Actions
        tbody
          each transaction in transactions
            tr
              td= transaction.date.toLocaleDateString()
              td= transaction.category
              td= transaction.amount
              td
                button.btn.btn-info.btn-sm.view-button(data-transaction-id=transaction._id) View
                a.btn.btn-primary.btn-sm(href="/transactions/" + transaction._id + "/edit") Edit
                button.btn.btn-danger.btn-sm Delete

      // View Transaction Modal
      #viewTransactionModal.modal.fade(tabindex='-1', role='dialog')
        .modal-dialog
          .modal-content
            .modal-header
              h5.modal-title View Transaction
              button.close(data-dismiss='modal', aria-label='Close')
                span(aria-hidden='true') Ã—
            .modal-body
              p#transactionDate
              p#transactionCategory
              p#transactionAmount
              p#transactionDescription
            .modal-footer
              button.btn.btn-secondary(type='button', data-dismiss='modal') Close

    script.
      $(document).on('click', '.view-button', function() {
        const transactionId = $(this).data('transaction-id');
        $.get(`/transactions/${transactionId}/view`, function(data) {
          $('#transactionDate').text('Date: ' + new Date(data.date).toLocaleDateString());
          $('#transactionCategory').text('Category: ' + data.category);
          $('#transactionAmount').text('Amount: $' + data.amount.toFixed(2));
          $('#transactionDescription').text('Description: ' + data.description);
          $('#viewTransactionModal').modal('show');
        }).fail(function() {
          alert('Transaction not found.');
        });
      });
